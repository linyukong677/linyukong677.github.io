---
layout: post
title: 计算机网络安全技术——传输层安全：SSL
date: 2022-11-11 21:03 +0800
last_modified_at: 2022-11-12 13:41 +0800
tags: [Notes]
toc:  true
math: true
---

本文内容是2022年秋季学期清华大学计算机系本科课程《计算机网络安全技术》的笔记。（传输层安全部分）
{: .message }

SSL协议工作在TCP协议的上层（目前SSL不支持UDP），应用层协议的下层，可用于保护正常运行于TCP之上的任何应用层协议。SSL提供的服务包括：

- 保密服务（加密）
- 完整性检验
- 认证

## SSL体系架构Overview

- SSL工作在客户机与服务器之间
- 会话协商+连接，一次会话协商可以对应多条连接
- 两层协议：握手协议+记录协议。握手协议发生在数据传输前，进行身份认证、协商加密算法、交换密钥等，记录协议发生在数据传输过程中，对数据进行加解密，加解压缩、完整性检验等

![会话与连接.png](https://s2.loli.net/2022/11/19/Ut9nrjKhEGzT7am.png)

## SSL记录协议

SSL记录协议主要提供两个服务：

- 保密（加密）
- 数据完整性

此外，SSL记录协议还有一项可选功能：对报文的加解压缩

其工作流程为：

- 报文分片
- 计算MAC，加到报文后面
- 对报文+MAC加密
- 加SSL头部

![SSL记录协议.png](https://s2.loli.net/2022/11/19/wMJaAYzBkvfs9H2.png)

## SSL握手协议

SSL握手协议主要提供三个功能：

- Client和Server之间认证
- 协商加密算法
- 协商密钥

其工作流程为：

- Phase1：hello，客户机和服务器双方互相hello，hello内容中会交换加密算法、加解密算法等等
- Phase2：服务器向客户机发送认证和密钥
- Phase3：客户机向服务器发送认证和密钥
- Phase4：客户端计算密钥并发送给服务器使双方密钥同步

![SSL握手协议.png](https://s2.loli.net/2022/11/19/BahkKjD5fyIquwM.png)

> 为什么Phase2,3交换过一次密钥，Phase4又要交换密钥？
> 
> Phase2,3的密钥我们称之为pre_master_key，Phase4的密钥才是master_key。pre_master_key是为握手过程中的加密服务的（因为握手阶段涉及master_key的传输，总不能明文传吧），而master_key才是后面的记录协议中使用的密钥。master_key是客户端基于pre_master_key算出来的

## SSL告警协议和SSL修改密码规约协议

告警协议用于向对等实体传递SSL相关的警报。如果告警的标识为致命， SSL将立即中止连接，而会话中的其它连接将继续进行，但不会在此会话中建立新连接。

修改密码规范协议握手协议的结束阶段发送，通知接收方，以后的记录将使用刚才协商的密码算法和密钥进行加密/认证

## SSL Discussion

1. 保密问题： SSL协议的数据安全性其实就是建立在RSA等算法的安全性上，从本质上来讲，攻破RSA等算法就等同于攻破此协议
2. 认证问题： SSL对应用层不透明，只能提供交易中客户与服务器间的双方认证，在涉及多方的电子交易中， SSL协议并不能协调各方间的安全传输和信任关系